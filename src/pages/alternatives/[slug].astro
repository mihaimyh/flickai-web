---
import { getCollection } from 'astro:content';
import BlogLayout from '../../layouts/BlogLayout.astro';
import { getTranslations } from '../../utils/i18n';
import { isValidAlternativeSlug } from '../../utils/alternatives';

export async function getStaticPaths() {
  const alternatives = await getCollection('alternatives', ({ data }) => {
    // Only include English alternatives for the default route
    return data.lang === 'en';
  });
  
  return alternatives.map((alternative) => {
    // For English files, slug is the filename without .md extension
    // e.g., "expensify-alternatives.md" becomes slug "expensify-alternatives"
    // No language suffix cleaning needed for English files
    
    return {
      params: { 
        slug: alternative.slug
      },
      props: { alternative },
    };
  });
}

const { alternative } = Astro.props;
const { slug } = Astro.params;

// Validate slug is a valid alternative slug
if (!slug || !isValidAlternativeSlug(slug)) {
  return Astro.redirect('/404');
}

const translations = getTranslations('en');
const { Content } = await alternative.render();
---

<BlogLayout 
  title={alternative.data.title}
  description={alternative.data.description}
  keywords={alternative.data.keywords}
  lang={alternative.data.lang}
  publishDate={alternative.data.publishDate}
>
  <Content />
  
  <div class="mt-12 pt-8 border-t border-gray-200 dark:border-gray-700">
    <p class="text-center">
      <a href="/alternatives/" class="text-primary hover:text-primary-dark font-semibold">
        ‚Üê Back to Alternatives
      </a>
    </p>
  </div>
</BlogLayout>
